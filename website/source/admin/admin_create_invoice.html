<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Créer une Facture - Admin</title>
    <!-- Link to your admin_style.css. Adjust path if necessary. -->
    <link rel="stylesheet" href="css/admin_style.css">
    <!-- Tailwind CSS (if you are using it) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Additional styles specific to this page or to mimic Google Doc if not covered by admin_style.css/Tailwind */
        body {
            font-family: 'Arial', sans-serif; /* Or a font consistent with your design */
            color: #333;
            background-color: #f4f7f6; /* Light background for the page */
            margin: 0;
            padding: 20px;
        }
        .invoice-container {
            max-width: 800px; /* A4-like width */
            margin: 20px auto;
            padding: 30px;
            background-color: #fff;
            border: 1px solid #e0e0e0;
            box-shadow: 0 0 15px rgba(0,0,0,0.05);
        }
        .invoice-header, .invoice-footer {
            padding-bottom: 20px;
            margin-bottom: 20px;
            border-bottom: 2px solid #0056b3; /* Accent color */
        }
        .invoice-footer {
            border-top: 2px solid #0056b3;
            border-bottom: none;
            margin-top: 30px;
            padding-top: 20px;
            font-size: 0.8em;
            text-align: center;
        }
        .company-details p, .customer-details p, .invoice-info p {
            margin: 2px 0;
            line-height: 1.4;
        }
        .section-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #0056b3;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .line-items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .line-items-table th, .line-items-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        .line-items-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .line-items-table td input[type="text"], 
        .line-items-table td input[type="number"],
        .line-items-table td select {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .totals-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed #ccc;
            /* max-width: 350px; /* Adjust width as needed */
            /* margin-left: auto; /* Pushes the section to the right */
        }
        .totals-section div {
            display: grid; /* Use grid for better control */
            grid-template-columns: 1fr auto; /* Label takes available space, value takes auto space */
            gap: 10px; /* Space between label and value */
            padding: 5px 0;
            align-items: center; /* Vertically align items if they have different heights */
        }
        .totals-section div span:first-child { /* Label */
            text-align: left;
        }
        .totals-section div span:last-child { /* Value */
            text-align: right;
            min-width: 100px; /* Ensure some minimum width for alignment */
        }
        .totals-section div.grand-total span:first-child,
        .totals-section div.grand-total span:last-child {
            font-weight: bold;
            font-size: 1.1em;
            color: #0056b3;
        }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: .5rem; font-weight: bold; }
        .form-group select, .form-group input, .form-group textarea {
            width: 100%;
            padding: .5rem;
            border: 1px solid #ccc;
            border-radius: .25rem;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }
        .btn-primary {
            background-color: #0056b3; /* Primary button color */
            color: white;
        }
        .btn-primary:hover {
            background-color: #004494;
        }
        .btn-secondary {
            background-color: #6c757d; /* Secondary button color */
            color: white;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .font-bold { font-weight: bold; }
        .mt-4 { margin-top: 1rem; }
        .mb-4 { margin-bottom: 1rem; }
        .grid { display: grid; }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .gap-4 { gap: 1rem; }
        .w-full { width: 100%; }
         /* For readonly fields */
        .readonly-field {
            background-color: #e9ecef; /* Light grey background */
            padding: 0.5rem;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
            min-height: 38px; /* Match input height */
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="admin-container p-4"> <!-- Assuming admin-container is from your admin_style.css -->
        <header class="mb-6">
            <h1 class="text-2xl font-bold text-gray-800">Créer une Nouvelle Facture</h1>
        </header>

        <div class="form-group">
            <label for="professional-user-select">Client Professionnel :</label>
            <select id="professional-user-select" name="professional_user_id" class="form-control">
                <option value="">Sélectionnez un client</option>
                <!-- Options will be populated by JavaScript -->
            </select>
        </div>

        <div class="invoice-container bg-white shadow-md rounded-lg p-8">
            <!-- Invoice Header -->
            <div class="invoice-header grid grid-cols-2 gap-4 items-start">
                <div>
                    <!-- Logo: Path from config.py MAISON_TRUVRA_LOGO_PATH_INVOICE -->
                    <!-- Assuming static assets are served from a /static/ route -->
                    <img src="/static/logos/maison_truvra_invoice_logo.png" alt="Maison Trüvra Logo" style="max-width: 200px; height: auto; margin-bottom: 20px;">
                    <div id="company-info-display" class="company-details">
                        <p class="font-bold text-lg" id="company-name">Maison Trüvra SARL</p>
                        <p id="company-address1">1 Rue de la Truffe</p>
                        <p id="company-address2"></p>
                        <p id="company-city-postal-country">75001 Paris, France</p>
                        <p>SIRET: <span id="company-siret">FRXX123456789</span></p>
                        <p>TVA: <span id="company-vat">FRXX123456789</span></p>
                    </div>
                </div>
                <div class="text-right">
                    <h2 class="text-3xl font-bold uppercase text-blue-700">FACTURE</h2>
                    <div class="invoice-info mt-2">
                        <p><strong>Facture N°:</strong> <span id="invoice-number-display">En attente de sélection client</span></p>
                        <p><strong>Date:</strong> <input type="date" id="invoice-date" class="form-control mt-1 inline-block w-auto"></p>
                        <p><strong>Date d'échéance:</strong> <input type="date" id="invoice-due-date" class="form-control mt-1 inline-block w-auto"></p>
                    </div>
                </div>
            </div>

            <!-- Customer Details -->
            <div class="grid grid-cols-2 gap-6 mt-6 mb-6 pb-6 border-b-2 border-gray-200">
                <div>
                    <h3 class="section-title">Facturé à :</h3>
                    <div id="customer-billing-info" class="customer-details">
                        <p class="font-bold" id="customer-company-name">Nom de l'Entreprise Cliente</p>
                        <p id="customer-contact-name">Prénom Nom (Contact)</p>
                        <div id="customer-billing-address" class="readonly-field min-h-[60px]">Adresse de facturation</div>
                        <p>SIRET: <span id="customer-siret-display" class="readonly-field"></span></p>
                        <p>N° TVA Intra.: <span id="customer-vat-display" class="readonly-field"></span></p>
                    </div>
                </div>
                <div>
                    <h3 class="section-title">Livré à :</h3>
                    <div id="customer-delivery-info" class="customer-details">
                        <p class="font-bold" id="delivery-company-name">Nom de l'Entreprise Cliente (Livraison)</p>
                         <div id="customer-delivery-address" class="readonly-field min-h-[60px]">Adresse de livraison</div>
                    </div>
                </div>
            </div>
            
            <!-- Line Items -->
            <h3 class="section-title">Détails de la facture :</h3>
            <table class="line-items-table w-full">
                <thead>
                    <tr>
                        <th>Description</th>
                        <th style="width: 10%;">Qté</th>
                        <th style="width: 15%;">Prix Unit. HT</th>
                        <th style="width: 10%;">TVA (%)</th>
                        <th style="width: 15%;">Total HT</th>
                        <th style="width: 15%;">Total TTC</th>
                        <th style="width: 5%;">Action</th>
                    </tr>
                </thead>
                <tbody id="invoice-items-tbody">
                    <!-- Line items will be added here by JavaScript -->
                </tbody>
            </table>
            <button type="button" id="add-invoice-item-btn" class="btn btn-secondary mt-4">+ Ajouter une ligne</button>

            <!-- Totals -->
            <div class="totals-section mt-6"> <!-- Removed text-right here, handled by child spans -->
                <div><span>Sous-Total HT :</span> <span id="subtotal-ht">0.00 €</span></div>
                <div id="vat-summary-container">
                    <!-- VAT per rate will be populated here. Example: <div><span>TVA (20%) :</span> <span>10.00 €</span></div> -->
                </div>
                <div><span>Total TVA :</span> <span id="total-vat">0.00 €</span></div>
                <div class="grand-total"><span>TOTAL TTC :</span> <span id="grand-total-ttc">0.00 €</span></div>
                <div class="grand-total mt-2"><span>NET À PAYER :</span> <span id="net-to-pay">0.00 €</span></div>
            </div>

            <!-- Payment Information -->
            <div class="mt-6 pt-6 border-t-2 border-gray-200">
                <h3 class="section-title">Conditions de paiement :</h3>
                <p>Paiement à réception de facture, au plus tard sous <span id="payment-due-days">30</span> jours.</p>
                <p>Mode de paiement : Virement bancaire</p>
                <p><strong>IBAN :</strong> <span id="company-iban">FRXX XXXX XXXX XXXX XXXX XXX</span></p>
                <p><strong>BIC/SWIFT :</strong> <span id="company-swift">XXXXXXX</span></p>
                <p>En cas de retard de paiement, une pénalité égale à 3 fois le taux d'intérêt légal sera appliquée (Décret 2009-138 du 9 février 2009). Pas d'escompte pour paiement anticipé.</p>
            </div>

            <!-- Invoice Footer -->
            <div class="invoice-footer mt-8 text-xs text-gray-600">
                <p>Maison Trüvra SARL - Capital Social : XXXXX € - RCS Paris : XXXXXXXXX - NAF : XXXXX</p>
                <p>1 Rue de la Truffe, 75001 Paris, France - Tél : +33 X XX XX XX XX - Email : contact@maisontruvra.com</p>
                <p>Merci de votre confiance !</p>
            </div>

            <!-- Action Buttons -->
            <div class="mt-8 text-center">
                <button type="button" id="save-invoice-btn" class="btn btn-primary">Enregistrer la Facture</button>
                <button type="button" id="preview-invoice-btn" class="btn btn-secondary">Aperçu PDF</button>
            </div>
        </div>
    </div>

    <!-- Template for invoice item row -->
    <template id="invoice-item-template">
        <tr>
            <td><input type="text" name="item_description[]" class="item-description" placeholder="Description du produit/service"></td>
            <td><input type="number" name="item_quantity[]" class="item-quantity" value="1" min="0.1" step="0.1"></td>
            <td><input type="number" name="item_unit_price_ht[]" class="item-unit-price-ht" value="0.00" min="0" step="0.01"></td>
            <td>
                <select name="item_vat_rate[]" class="item-vat-rate">
                    <option value="20">20%</option>
                    <option value="10">10%</option>
                    <option value="5.5">5.5%</option>
                    <option value="2.1">2.1%</option>
                    <option value="0">0%</option>
                </select>
            </td>
            <td><span class="item-total-ht">0.00</span> €</td>
            <td><span class="item-total-ttc">0.00</span> €</td>
            <td><button type="button" class="remove-item-btn btn btn-danger btn-sm">X</button></td>
        </tr>
    </template>

    <!-- Include the JavaScript file for this page -->
    <!-- Adjust path if necessary. Assuming it's in the same 'js' folder as other admin JS files -->
    <script src="js/admin_api.js"></script> <!-- Assuming admin_api.js contains your fetchAPIData function -->
    <script src="js/admin_create_invoice_js.js"></script>
</body>
</html>
